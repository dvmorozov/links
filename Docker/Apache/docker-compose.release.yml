version: '3.8'

services:
  links-legacy-apache-release:
    build:
      context: .
      dockerfile: Dockerfile
      target: base
    image: links-legacy-apache:release
    container_name: links-legacy-apache-release
    ports:
      - "4444:443"  # Release uses port 4444
    volumes:
      # Project HTML content
      - "${HOST_PROJECT_PATH}:/var/www/html"
      # Library data directory (mapped to test user's directory for consistency)
      - "${HOST_LIBRARY_PATH}:/var/www/html/users/links/test"
      # CGI binary
      - "${HOST_CGI_PATH}/links-legacy-release.exe:/usr/lib/cgi-bin/links-legacy.exe:ro"
      # Static CSS file
      - "${HOST_SOURCES_PATH}/Content/Styles.css:/var/www/html/links/Styles.css:ro"
      # Static JS file  
      - "${HOST_SOURCES_PATH}/Content/Common.js:/var/www/html/links/Common.js:ro"
      # Static images directory
      - "${HOST_SOURCES_PATH}/Content/legacy-images:/var/www/html/links/legacy-images:ro"
      # Initialization script
      - "./init.sh:/init.sh:ro"
    environment:
      - BUILD_TYPE=Release
    command: ["/init.sh", "apachectl", "-D", "FOREGROUND"]


